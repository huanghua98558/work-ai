# WorkBot 部署指南

## 系统初始化

### 首次部署步骤

1. **访问初始化页面**
   - 部署后访问：`http://your-domain/init`
   - 如果系统检测到没有管理员账户，会显示初始化页面

2. **创建管理员账户**
   - 默认账号：`admin`
   - 默认密码：`admin123`
   - 默认昵称：`超级管理员`
   - 你可以修改这些信息

3. **登录系统**
   - 初始化完成后，访问：`http://your-domain/login`
   - 使用刚创建的管理员账号登录

### 如果已经有管理员账户

如果系统已经有管理员账户，访问 `/init` 页面会直接跳转到登录页面。

## 管理员功能

登录后，管理员可以访问以下功能：

- **激活码管理**：生成、查看、编辑、删除激活码，支持批量生成
- **机器人管理**：创建和管理机器人
- **对话管理**：查看和管理对话记录
- **知识库管理**：管理知识库内容
- **用户管理**：查看和管理用户

## 环境变量配置

在 `.env` 文件中配置以下变量：

```env
# 数据库连接
PGDATABASE_URL=postgresql://username:password@host:port/database

# JWT 密钥（生产环境请修改）
JWT_SECRET=your-secret-key-change-in-production
```

## 数据库迁移

如果需要重新初始化数据库，可以执行以下API：

### 创建管理员账户

```bash
curl -X POST http://your-domain/api/init/admin \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "admin",
    "password": "admin123",
    "nickname": "超级管理员"
  }'
```

### 检查初始化状态

```bash
curl http://your-domain/api/init/admin
```

## 常见问题

### 1. 登录失败

**问题**：提示"用户不存在"或"密码错误"

**解决方案**：
- 确保已创建管理员账户
- 检查账号和密码是否正确
- 如果忘记密码，可以重新调用 `/api/init/admin` API 创建新账户

### 2. 创建激活码失败

**问题**：提示"未授权访问"

**解决方案**：
- 确保已登录且账户角色为 `admin`
- 检查 JWT token 是否过期
- 重新登录获取新的 token

### 3. 部署后无法访问

**问题**：页面无法打开

**解决方案**：
- 检查服务是否正常启动（端口 5000）
- 检查数据库连接是否正常
- 查看日志文件：`/app/work/logs/bypass/app.log`

## 开发环境

开发环境已预置测试管理员账户：
- 账号：`15000150000`
- 密码：`15000150000`

**注意**：这是测试账户，不建议在生产环境使用。

## 生产环境建议

1. 修改默认 JWT_SECRET
2. 修改默认管理员账号和密码
3. 启用 HTTPS
4. 定期备份数据库
5. 启用日志监控

## 技术支持

如有问题，请查看日志文件或联系技术支持。
