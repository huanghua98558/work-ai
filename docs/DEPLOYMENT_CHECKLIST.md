# WorkBot 部署检查清单

## ✅ 部署前检查

### 数据库
- [ ] 已创建 PostgreSQL 数据库
- [ ] 已创建数据库用户
- [ ] 已获取数据库连接信息（主机、端口、用户名、密码、数据库名）
- [ ] 已测试数据库连接
- [ ] 数据库允许从部署服务器访问（防火墙规则）

### 环境变量
- [ ] 已配置 `DATABASE_URL`（或 `POSTGRES_URL`）
- [ ] 已配置 `JWT_SECRET`（至少 32 字符）
- [ ] 已验证环境变量格式正确
- [ ] 已设置 `NODE_ENV=production`
- [ ] 已设置 `PORT=5000`

### 代码
- [ ] 代码已推送到 Git 仓库
- [ ] `.coze` 文件配置正确
- [ ] `scripts/start.sh` 有执行权限
- [ ] `scripts/deploy-build.sh` 有执行权限
- [ ] `package.json` 包含正确的启动脚本

## ✅ 部署中检查

### 构建阶段
- [ ] 代码打包成功
- [ ] 依赖安装成功（541 个包）
- [ ] TypeScript 编译通过
- [ ] ESLint 检查通过
- [ ] Next.js 构建成功
- [ ] 静态页面生成成功（35 个页面）

### 数据库集成
- [ ] 数据库管道启动
- [ ] 数据库连接测试成功
- [ ] 数据库表创建成功（如果使用自动迁移）

### 启动阶段
- [ ] 环境变量检查通过
- [ ] 服务进程启动成功
- [ ] 进程 ID 正常
- [ ] 端口 5000 监听正常
- [ ] 健康检查通过
- [ ] 就绪检查通过

## ✅ 部署后验证

### 基本功能
- [ ] 主页可访问（200 OK）
- [ ] API 健康检查正常
- [ ] API 就绪检查正常
- [ ] 登录页面可访问
- [ ] 管理后台可访问

### 功能测试
- [ ] 用户可以登录
- [ ] 仪表盘数据正常显示
- [ ] 可以创建机器人
- [ ] 可以生成激活码
- [ ] 可以上传知识库文档

### 性能检查
- [ ] 首页加载时间 < 3 秒
- [ ] API 响应时间 < 1 秒
- [ ] 内存使用正常
- [ ] CPU 使用率正常

### 日志检查
- [ ] 应用日志正常记录
- [ ] 错误日志没有严重错误
- [ ] 访问日志正常记录

## 🚨 常见问题速查

| 问题 | 检查项 | 解决方案 |
|------|--------|----------|
| 环境变量错误 | `DATABASE_URL` | 检查环境变量配置 |
| 数据库连接失败 | 连接字符串 | 验证主机、端口、用户名、密码 |
| 启动超时 | 日志文件 | 检查 `/app/work/logs/bypass/app.log` |
| 内存不足 | 内存使用 | 增加内存限制或优化连接池 |
| 端口占用 | 端口 5000 | 检查是否有其他进程占用 |

## 📞 快速诊断命令

```bash
# 检查服务状态
curl https://your-domain.com/api/health

# 检查数据库连接
psql $DATABASE_URL -c "SELECT 1"

# 查看日志（最后 20 行）
tail -n 20 /app/work/logs/bypass/app.log

# 检查端口监听
netstat -tuln | grep 5000

# 运行诊断脚本
bash scripts/diagnose.sh
```

## 📝 部署记录

### 基本信息
- **部署日期**: ___________
- **部署平台**: ___________
- **部署版本**: ___________
- **数据库类型**: ___________
- **数据库版本**: ___________

### 环境变量
- **DATABASE_URL**: `postgresql://***:***@***:5432/**`
- **JWT_SECRET**: `***` (长度: _____ 字符)
- **NODE_ENV**: `production`
- **PORT**: `5000`

### 部署结果
- **构建时间**: ___________
- **启动时间**: ___________
- **总部署时间**: ___________
- **部署状态**: ✅ 成功 / ❌ 失败

### 问题记录
1. ____________________________________________________
2. ____________________________________________________
3. ____________________________________________________

### 备注
___________________________________________________________________
___________________________________________________________________
___________________________________________________________________

---

**下一步**:
- 部署成功后，请参考 [部署指南](./DEPLOYMENT_GUIDE.md) 进行初始化配置
- 如遇问题，请查看 [故障排查指南](./TROUBLESHOOTING.md)
